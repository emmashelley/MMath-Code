close all
clear all
clc
 
%same parameters
KIP3 = 0.13;
Ke = 0.1;
Kp = 0.13;
Vp = 0.01;
K3K = 0.4;
beta = 0.185;
ctot = 2;
 
 
positive = 1;
 
%differing parameters
if positive == 1
    Kact = 0.08;
    v1 = 1.11;
    Ve = 0.9;
    KPLC = 0.2;
    k5P = 0.66;
    k3K = 0;
    tn = 12.5;
    Kinh = 0.4;
    k2 = 0.0203;
    Vplc = [0:0.0005:2.5];
    rangek = 30;
else
    Kact = 0.2;
    v1 = 7.4;
    Ve = 0.25;
    KPLC = 0;
    k5P = 0;
    k3K = 0.1;
    tn = 6.6;
    Kinh = 0.3;
    k2 = 0.00148;
    Vplc = [0:0.00001:0.01];
    rangek = 21;
end
 
if positive==1 
    c21 =@(a,b,c) -(1591002244266435*a/37)-(18543149700075000*b/37)-(72040208625000000*c/37)-(45502664186020041/37000);
    c20 =@(a,b,c) -(53089599678733332*a/185)-(123751980603108000*b/37)-(480776925420000000*c/37)-(1897953188514716619/231250);
    c19 =@(a,b,c) -(609011475350850000*c/37)-(6788624945873404491*a/18500)-(157501279743311790*b/37)-(975323633678498846313/92500000);
    c18 =@(a,b,c) -(28116057154170061791*a/115625)-(621031400813736000*c/37)-(499558361999099832*b/185)-(4210391491897790498013/578125000);
    c17 =@(a,b,c) (276027901010254800*c/37)-(273718236641341837059*a/2312500)-(1118574415554319152*b/925)-(21997787338005683455251/5781250000);
    c16 =@(a,b,c) -(135842857407823780071*a/2890625)-(81222284783597760*c/37)-(406728355228427232*b/925)-(11723062391182559693133/7226562500);
    c15 =@(a,b,c) -(438199397327906128629*a/28906250)+(42848738626217040*c/37)-(2967200850906344052*b/23125)-(164466735475493035487331/289062500000);
    c14 =@(a,b,c) -(303184434378342120318*a/72265625)-(20376294177488832*c/185)-(3620147209934173776*b/115625)-(1696781154741127669071/9765625000);
    c13 =@(a,b,c) -(725783221226493564849*a/722656250)+(52668726253851312*c/925)-(3800008671019003872*b/578125)-(83224757226639578083677/1806640625000);
    c12 =@(a,b,c) -(73878309591767580042*a/361328125)-(11031943417856064*c/4625)-(3268273264822710144*b/2890625)-(12022295684277092866938/1129150390625);
    c11 =@(a,b,c) -(267203294419356319167*a/7226562500)+(25844360776382016*c/23125)-(2428506350411213358*b/14453125)-(398624356780616927751219/180664062500000);
    c10 =@(a,b,c) -(50559894317799133839*a/9033203125)-(79587503880192*c/4625)-(1445935995578141496*b/72265625)-(17794663159068040084983/45166015625000);
    c9 =@(a,b,c) (4057680944123136*c/578125)-(132737928103850227587*a/180664062500)-(28595797410409268092911/451660156250000)-(665617847813733672*b/361328125);
    c8 =@(a,b,c) -(89482126368797241651*a/1129150390625)-(222728365611550656*b/1806640625)+(100996207082496*c/2890625)-(24473134253982193125489/2822875976562500);
    c7 =@(a,b,c) -(37013919698753098101*a/5645751953125)-(4923683392975776*b/1806640625)+(44231622994944*c/14453125)-(116079580661939684838477/112915039062500000);
    c6 =@(a,b,c) -(11029558444062557256*a/28228759765625)+(17048954067260544*b/45166015625)+(39841579008*c/578125)-(14373170928238951243701/141143798828125000);
    c5 =@(a,b,c) -(938579853759794532*a/141143798828125)+(7115762349311616*b/225830078125)-(5427207436009343646519/705718994140625000);
    c4 =@(a,b,c) -(180043158089810704689/441074371337890625)+(25870646906531856*a/19073486328125)+(6409514022912*b/9033203125);
    c3 =@(a,b,c) (381582755981835408*a/3528594970703125)-(19912646245562038683/4410743713378906250);
    c2 =@(a,b,c) (17878176552423878262/11026859283447265625)+(343710189478656*a/141143798828125);
    c1 =@(a,b,c) (6820791763175307918/55134296417236328125);
    c0 =@(a,b,c) (6143819636930976/2205371856689453125);
    cvec =@(a,b,c)[c21(a,b,c);
    c20(a,b,c);
    c19(a,b,c);
    c17(a,b,c);
    c16(a,b,c);
    c15(a,b,c);
    c14(a,b,c);
    c13(a,b,c);
    c12(a,b,c);
    c11(a,b,c);
    c10(a,b,c);
    c9(a,b,c);
    c8(a,b,c);
    c7(a,b,c);
    c6(a,b,c);
    c5(a,b,c);
    c4(a,b,c);
    c3(a,b,c);
    c2(a,b,c);
    c1(a,b,c);
    c0(a,b,c)];
else
    C18 =@(a,b,c) -(520689/1250)-(189600000*c)-(480636*a/5)-(7394400*b);
    C17 =@(a,b,c) -(27266967/2500)-(4964400000*c)-(12584754*a/5)-(193611600*b);
    C16 =@(a,b,c) -(988406133/62500)-(7289232000*c)-(91621998*a/25)-(283096944*b);
    C15 =@(a,b,c) -(605530549/62500)-(32388784000*c)-(329814654*a/125)-(233940720*b);
    C14 =@(a,b,c) -(39407121039/12500000)-(729929538*b/5)+(38295348240*c)-(3278590029*a/2500);
    C13 =@(a,b,c) -(14267873841/25000000)-(350613471*b/5)-(15299814600*c)-(12235806687*a/25000);
    C12 =@(a,b,c) -(33562951643/625000000)-(16099380921*a/125000)-(3256007781*b/125)+(19901184424*c);
    C11 =@(a,b,c) -(1156938003/625000000)-(13437330777*a/625000)-(191940177*b/25)-(2573178168*c);
    C10 =@(a,b,c) (579131397/15625000000)-(1233901617*a/625000)-(5428233213*b/3125)+(84342920136*c/25);
    C9 =@(a,b,c) -(265616793*a/3906250)-(843258312*b/3125)+(59319/39062500)-(4072896544*c/25);
    C8 =@(a,b,c) (133645707*a/97656250)-(9450429144*b/390625)+(632431775712*c/3125);
    C7 =@(a,b,c) (109512*a/1953125)-(325228176*b/390625)-(6802522752*c/3125);
    C6 =@(a,b,c) (164487024*b/9765625)+(130519542656*c/78125);
    C5 =@(a,b,c) (269568*b/390625)-(265471488*c/78125);
    C4 =@(a,b,c) (134963712*c/1953125);
    C3 =@(a,b,c) (221184*c/78125);
    C2 =@(a,b,c) 0;
    C1 =@(a,b,c) 0;
    C0 =@(a,b,c) 0;
    Cvec =@(a,b,c) [C18(a,b,c);
        C17(a,b,c);
        C16(a,b,c);
        C15(a,b,c);
        C14(a,b,c);
        C13(a,b,c);
        C12(a,b,c);
        C11(a,b,c);
        C10(a,b,c);
        C9(a,b,c);
        C8(a,b,c);
        C7(a,b,c);
        C6(a,b,c);
        C5(a,b,c);
        C4(a,b,c);
        C3(a,b,c);
        C2(a,b,c);
        C1(a,b,c);
        C0(a,b,c)]; 
end
 
 
%finding roots
if positive==1
    results = nan(length(Vplc),3);
    k=1;
    for VPLC= Vplc
        a = VPLC;
        b= VPLC^2;
        c=VPLC^3;
 
        vec = cvec(a,b,c);
        sols = roots(vec);
        sols = sols(imag(sols)==0);
        sols=sols(sols>0);
 
        if length(sols)==1
            results(k,1) = sols;
        else
            results(k,:) = sols;
        end
        k = k+1;
    end
else
    results = nan(length(Vplc),3);
    n=1;
    for VPLC= Vplc
        a = VPLC;
        b= VPLC^2;
        c=VPLC^3;
        vec = Cvec(a,b,c);
        sols = roots(vec);
        sols = sols(imag(sols)==0);
        sols = sols(sols>0);
        results(n,1)=sols;
        n=n+1;
    end
end
 

 
 
resultsn = Kinh./(Kinh + results);
 
p1 = [Vplc' Vplc' Vplc'].*(results.^2);
p2 = KPLC.^2 + results.^2;
p3 = (k3K.*(results.^2))./(K3K.^2+results.^2);
resultsp = -p1./((p2).*(-k5P-p3));

 

j1= 3*v1*resultsn.^2.*results.^2.*resultsp.^2;
j2 = (Kact+results).^3;
j3 = (KIP3+resultsp).^3;
j4 = (j1.*resultsn.*resultsp)./(j2.*j3);
j5 = (j4.*results)./(Kact+results);
j6 = (ctot-results)./beta;
j7 = Ke^2 + results.^2;
j8 = (2*Ve.*results)./(j7);
j16 = (-1/beta)-1; 
j17 = j4./3;
J11 = ((j4-j5).*(j6-results))+((j17.*results+k2).*(j16))-j8+(j8.*results.^2)./j7;
J12 = (j1.*(j6-results).*results.*resultsp)./(j2.*j3);
j9 = (j1.*resultsn.*results)./(j2.*j3);
j10 = (j9.*resultsp)./(KIP3+resultsp);
J13 = ((j9-j10).*(j6-results));
J21 = -(resultsn)./(tn.*Kinh);
J22 = -(Kinh+results)./(tn.*Kinh);
j11 = KPLC^2+results.^2;
j12 = (2.*[Vplc' Vplc' Vplc'].*results)./j11;
j13 = K3K^2+results.^2;
j14 = (2.*k3K.*results)./j13;
J31 = j12-((j12.*results.^2)./j11)-(j14-((j14.*results.^2)./j13)).*resultsp;
j15 = (k3K.*results.^2)./(K3K.^2+results.^2);
J33 = -k5P-j15;

[m,n] = size(results);
Stab_vec = nan(size(results));
Osc_vec = nan(size(results));
for i = 1:m
    for j = 1:n
        Jvec = [J11(i,j), J12(i,j), J13(i,j); J21(i,j), J22(i,j), 0; J31(i,j), 0, J33(i,j)];
        e = eig(Jvec);
        if max(real(e))>0
            Stab_vec(i,j)=0;
        else
            Stab_vec(i,j)=1;
        end
        if max(abs(imag(e)))~=0
            Osc_vec(i,j)=1;
        else
            Osc_vec(i,j)=0;
        end
    end
end

hold on

list_factory = fieldnames(get(groot,'factory'));
index_interpreter = find(contains(list_factory,'Interpreter'));
for i = 1:length(index_interpreter)
    default_name = strrep(list_factory{index_interpreter(i)},'factory','default');
    set(groot, default_name,'latex');
end


for i = 1:m
    for j = 1:n
        if Osc_vec(i,j) == 1
            if Stab_vec(i,j) == 1
                scatter(Vplc(i),results(i,j),'filled','r')
            else
                scatter(Vplc(i),results(i,j),'filled','b')
            end
        else 
            if Stab_vec(i,j) == 1
                scatter(Vplc(i),results(i,j),'filled','g')
            else
                scatter(Vplc(i),results(i,j),'filled','k')
            end
        end
    end
end

set(gca,'FontSize',24)
set(gcf, 'Position', [50,50,500,350])
set(gcf, 'Color', 'w')


xlabel('$V_{PLC}$ ($\mu M/s$)','Interpreter','latex')
ylabel('$c$ ($\mu M$)','Interpreter','latex')
